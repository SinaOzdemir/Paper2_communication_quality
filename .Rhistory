devtools::install_github("cjbarrie/academictwitteR")
library(academictwitteR)
library(tidyverse)
dataDIR<-paste0(getwd(),"/metadata")
metadata = readRDS(file = paste0(dataDIR,"/metadata_14-03-2021.RDS"))
View(metadata)
set.seed(28032021)
test_account = filter(metadata, statuses_count >3500) %>% sample_n(tbl = .,size = 1)
View(test_account)
test_account = filter(metadata, statuses_count >3500 & statuses_count < 5500) %>% sample_n(tbl = .,size = 1)
View(test_account)
creation_date<- test_account$account_created_at %>% str_split(string = .,pattern = " ",simplify = T)
start_date<- paste0(creation_date[,1],"T",creation_date[,2],"Z")
end_date <- paste0(Sys.Date(),"T00:00:00Z")
screen_name<- paste0(test_account$screen_name)
bearer_token <- "AAAAAAAAAAAAAAAAAAAAANh3NgEAAAAAYpb57mP0saX5D%2BCi4vfCvf%2FWp6Q%3DD6xFxcFGBkLGz0BWs6f4EylxpdxEeLIpLk867py48blqPVwQUm"
a<-get_user_tweets(users = screen_name,start_tweets = start_date,end_tweets = end_date,bearer_token = bearer_token,data_path = dataDIR)
a<-get_user_tweets(users = screen_name,start_tweets = start_date,end_tweets = end_date,bearer_token = bearer_token)
View(test_account)
View(a)
View(a[[4]][[1]])
library("rtweet")
install.packages("rtweet")
library("rtweet")
b=rtweet::parse_stream(path = a)
saveRDS(object = a,file = paste0(dataDIR,"/test_data.RDS"))
get_user_tweets(users = screen_name,start_tweets = start_date,end_tweets = end_date,bearer_token = bearer_token,data_path = paste0(dataDIR,"/jsons") )
library(pacman)
packs<- c("academictwitteR","tidyverse","tidyjson","rjson")
pacman::p_load(char = packs)
meta_dataDIR<- paste0(getwd(),"/metadata/")
json_dataDIR<- paste0(getwd(),"/Data/json/")
rds_dataDIR<- paste0(getwd(),"/Data/rds/")
test_jsonlist1<- jsonlite::fromJSON(file = paste0(json_data,"metadatadata_141787589999984640.json"),flatten = T)
meta_data<- readRDS(txt = paste0(meta_dataDIR,"metadata_14-03-2021.RDS")) %>% filter(user_id%in%json_list)
test_jsonlist1<- jsonlite::fromJSON(txt = paste0(json_data,"metadatadata_141787589999984640.json"),flatten = T)
test_jsonlist1<- jsonlite::fromJSON(txt = paste0(json_dataDIR,"metadatadata_141787589999984640.json"),flatten = T)
View(test_jsonlist1)
test_jsonlist1<- jsonlite::fromJSON(txt = paste0(json_dataDIR,"metadatadata_141787589999984640.json"),flatten = T) %>% as.data.frame()
View(test_jsonlist1)
typeof(test_jsonlist1$referenced_tweets)
final <-
sprintf(
"Handle: %s\nBio: %s\nPinned Tweet: %s",
json_data$data.username,
json_data$data.description,
json_data$includes.tweets.text
)
View(test_jsonlist1)
meta_data<- readRDS(file = paste0(meta_dataDIR,"metadata_14-03-2021.RDS"))
View(meta_data)
meta_data<- readRDS(file = paste0(meta_dataDIR,"metadata_14-03-2021.RDS")) %>% filter(user_id == "415555178")
View(meta_data)
test_rdsdf1<- readRDS(file = paste0(rds_dataDIR,meta_data$user_id[1],".RDS"))
test_rdsdf1<- readRDS(file = paste0(rds_dataDIR,meta_data$screen_name[1],".RDS"))
View(test_rdsdf1)
View(test_rdsdf1[[7]][[1]])
typeof(test_rdsdf1$entities)
typeof(test_rdsdf1$entities)
View(test_rdsdf1[[16]][[1]])
View(test_rdsdf1[[16]][[1]])
View(test_rdsdf1[[16]][[2]])
typeof(test_rdsdf1[1])
colnames(test_rdsdf1[1])
colnames(test_rdsdf1[7])
colnames(test_rdsdf1[8])
colnames(test_rdsdf1)
meta_data<- Hmisc::contents(test_rdsdf1)
View(meta_data)
meta_data<- Hmisc::contents(test_rdsdf1)[1]
View(meta_data)
meta_data<- Hmisc::contents(test_rdsdf1)[1] %>% as.data.frame()
View(meta_data)
class(test_rdsdf1$text)
meta_data<- Hmisc::contents(test_rdsdf1)[1] %>% as.data.frame() %>% mutate(variables = rownames(.))
View(meta_data)
View(meta_data)
View(meta_data)
View(meta_data)
colnames(meta_data)
meta_data<- Hmisc::contents(test_rdsdf1)[1] %>% as.data.frame() %>% mutate(variables = rownames(.)) %>% rename(class = contents.Class, type = contents.Storage,NA.count = contens.NAs)
meta_data<- Hmisc::contents(test_rdsdf1)[1] %>% as.data.frame() %>% mutate(variables = rownames(.)) %>% rename(class = contents.Class, type = contents.Storage,NA.count = contents.NAs)
View(meta_data)
class(test_rdsdf1)
class(test_rdsdf1$text)
View(test_jsonlist1)
View(test_rdsdf1)
to_unnest<- Hmisc::contents(test_rdsdf1)[1] %>%
as.data.frame() %>%
mutate(variables = rownames(.)) %>%
rename(class = contents.Class, type = contents.Storage,NA.count = contents.NAs) %>%
filter(type == "list")
View(to_unnest)
to_unnest_meta<- Hmisc::contents(test_rdsdf1)[1] %>%
as.data.frame() %>%
mutate(variables = rownames(.)) %>%
rename(class = contents.Class, type = contents.Storage,NA.count = contents.NAs) %>%
filter(type == "list")
vignette("rowwise")
View(test_rdsdf1)
colnames(to_unnest_meta)
to_unnest<- test_rdsdf1 %>% select(id, all_of(to_unnest_meta$variables))
View(to_unnest)
View(to_unnest_meta)
to_unnest_meta<- Hmisc::contents(test_rdsdf1)[1] %>%
as.data.frame() %>%
mutate(variables = rownames(.)) %>%
rename(class = contents.Class, type = contents.Storage,NA.count = contents.NAs) %>%
filter(class == "data.frame")
View(to_unnest_meta)
to_unnest<- test_rdsdf1 %>% select(id,entities)
View(to_unnest)
class(to_unnest$entities)
a<- as.tibble(to_unnest$entities)
a<- as_tibble(to_unnest$entities)
View(a)
View(a[[1]][[1]])
b<-unnest(a$mentions)
class(a$mentions[1])
b<-unlist(a$mentions[1])
b<-unlist(a$mentions[1])[3]
class(a$annotations[1])
c<-unlist(a$annotations[1])
View(a[[2]][[1]])
a[[2]]
d<-as.data.frame(a[[2]])
View(test_rdsdf1[[7]][[10]])
is_null(test_rdsdf1$entities$mentions)
test_rdsdf1$entities$mentions[5]
is_null(test_rdsdf1$entities$mentions[5])
is_null(test_rdsdf1$entities$mentions[[5]])
is_null(test_rdsdf1$entities$mentions[[4]])
test_rdsdf1$entities$mentions[[4]]
class(test_rdsdf1$entities$mentions[[4]])
typeof(test_rdsdf1$entities$mentions[[4]])
test_jsonlist1<- jsonlite::fromJSON(txt = paste0(json_dataDIR,"metadatadata_141787589999984640.json"))# %>% as.data.frame()
View(test_jsonlist1)
test_jsonlist<- rjson::fromJSON(file = paste0(json_dataDIR,"metadatadata_141787589999984640.json"),method = "C",simplify = T)
View(test_jsonlist)
test_jsonlist1<- jsonlite::fromJSON(txt = paste0(json_dataDIR,"metadatadata_141787589999984640.json"),flatten = T)# %>% as.data.frame()
test_jsonlist2<- rjson::fromJSON(file = paste0(json_dataDIR,"metadatadata_141787589999984640.json"),method = "C",simplify = T)
View(test_jsonlist1)
test_jsonlist1<- jsonlite::fromJSON(txt = paste0(json_dataDIR,"metadatadata_141787589999984640.json"),flatten = F)# %>% as.data.frame()
View(test_jsonlist1)
test_jsonlist3<- jsonlite::fromJSON(txt = paste0(json_dataDIR,"metadatadata_141787589999984640.json"),simplifyVector = T)
test_jsonlist3<- jsonlite::fromJSON(txt = paste0(json_dataDIR,"metadatadata_141787589999984640.json"),simplifyVector = F)
test_jsonlist3<- jsonlite::fromJSON(txt = paste0(json_dataDIR,"metadatadata_141787589999984640.json"),simplifyVector = T)
View(test_jsonlist3)
test_jsonlist4<- jsonlite::fromJSON(txt = paste0(json_dataDIR,"metadatadata_141787589999984640.json"),simplifyDataFrame = T)
View(test_jsonlist4)
View(test_jsonlist4)
test_jsonlist1<- jsonlite::fromJSON(txt = paste0(json_dataDIR,"metadatadata_141787589999984640.json"),flatten = T)# %>% as.data.frame()
colnames(test_jsonlist1)
colnames(test_jsonlist3)
View(test_jsonlist1)
test_jsonlist1<- jsonlite::fromJSON(txt = paste0(json_dataDIR,"metadatadata_141787589999984640.json"),flatten = T) %>% as.data.frame()
test_jsonlist1<- jsonlite::fromJSON(txt = paste0(json_dataDIR,"metadatadata_141787589999984640.json"),flatten = T) %>% as_tibble()
cat(test_jsonlist1)
head(test_jsonlist1)
View(test_jsonlist1)
View(test_jsonlist1)
test_jsonlist1$entities.annotations
to_unnest_meta<- Hmisc::contents(test_jsonlist1)
View(to_unnest_meta)
json_meta<- Hmisc::contents(test_jsonlist1)
View(meta_data)
View(json_meta)
json_df_meta<- json_meta[2]
View(json_df_meta)
json_meta[[2]]
json_meta[[2]][1]
json_content_meta<- json_meta[[1]] %>% as_tibble()
View(json_content_meta)
json_meta[[1]]
json_meta[[1]][1]
json_meta[[1]][2]
json_meta[1]
View(json_content_meta)
json_content_meta<- json_meta[[1]] %>% as_tibble(.,rownames = "variable.names")
View(json_content_meta)
devtools::install_github("jaeyk/tidytweetjson",dependencies = TRUE)
library(tidytweetjson)
test_jsonl<- jsonl_to_df(file_path = paste0(json_dataDIR,"metadatadata_141787589999984640.json"))
View(test_jsonl)
library(academictwitteR)
meta_dataDIR<- paste0(getwd(),"/metadata/")
json_dataDIR<- paste0(getwd(),"/Data/json/")
rds_dataDIR<- paste0(getwd(),"/Data/rds/")
meta_data<- readRDS(file = paste0(meta_dataDIR,"metadata_14-03-2021.RDS")) %>% filter(user_id == "415555178")
meta_data<- readRDS(file = paste0(meta_dataDIR,"metadata_14-03-2021.RDS")) %>% filter(user_id == "415555178")
View(meta_data)
test_rds1<- readRDS(file = paste0(rds_dataDIR,meta_data$screen_name[1],".RDS"))
test_flatt_rds1<- jsonlite::flatten(test_rds1)
View(test_flatt_rds1)
colnames(test_flatt_rds1)
colnames(test_rds1)
View(test_flatt_rds1[[8]][[1]])
a<-purrr::flatten_df(test_flatt_rds1$referenced_tweets)
a<-purrr::flatten(test_flatt_rds1$referenced_tweets)
View(a)
a<-purrr::flatten_dfc(test_flatt_rds1$referenced_tweets)
View(a)
a<-purrr::flatten_dfr(test_flatt_rds1$referenced_tweets)
test_flatt_rds1$referenced_tweets
a<-do.call("rbind",test_flatt_rds1$referenced_tweets)
View(a)
View(test_flatt_rds1[[8]][[3]])
is.null(test_flatt_rds1$referenced_tweets)
is.null(test_flatt_rds1$referenced_tweets[1])
is.null(test_flatt_rds1$referenced_tweets[2])
is.null(test_flatt_rds1$referenced_tweets[3])
is.null(test_flatt_rds1$referenced_tweets[[3]])
a<-test_flatt_rds1$referenced_tweets[[1]]
View(a)
test_flatt_rds1<- jsonlite::flatten(test_rds1)
test_flatt_rds1_meta<- Hmisc::contents(test_flatt_rds1)[1]
View(test_flatt_rds1_meta)
test_flatt_rds1_meta<- Hmisc::contents(test_flatt_rds1)[[1]] %>% as_tibble(rownames = "variable_names")
View(test_flatt_rds1_meta)
test_flatt_rds1_meta<- Hmisc::contents(test_flatt_rds1)[[1]] %>% as_tibble(rownames = "variable_names") %>% filter(Storage == "list")
View(test_flatt_rds1_meta)
View(test_flatt_rds1)
View(test_flatt_rds1[[8]][[1]])
to_unlist <- test_flatt_rds1 %>% select(id,all_of(test_flatt_rds1_meta$variable_names))
View(to_unlist)
View(to_unlist[[4]][[5]])
a<-as.data.frame(to_unlist$entities.mentions)
a<- unlist(to_unlist$entities.mentions,use.names = T)
names(a)
a<- do.call("rbind.data.frame",to_unlist$entities.mentions)
View(a)
View(to_unlist[[4]][[125]])
typeof(to_unlist$entities.mentions)
typeof(to_unlist$entities.mentions[[1]])
typeof(to_unlist$entities.mentions[[2]])
typeof(to_unlist$entities.mentions[[3]])
names(to_unlist$entities.mentions[1])
names(to_unlist$entities.mentions[[1]])
names(to_unlist$entities.mentions[[2]])
a<- do.call("rbind",to_unlist$entities.mentions)
View(a)
Hmisc::contents(to_unlist$entities.mentions[1])
Hmisc::contents(to_unlist$entities.mentions[[1]])
b<-Hmisc::contents(to_unlist$entities.mentions[[1]])
b$dim
b$dim[1]
b<-Hmisc::contents(to_unlist$entities.mentions[[1]])[2][1]
View(b)
View(b)
b<-Hmisc::contents(to_unlist$entities.mentions[[1]])[[2]][1]
b<-Hmisc::contents(to_unlist$entities.mentions[[1]])[[2]]
b<-Hmisc::contents(to_unlist$entities.mentions[[1]])
View(b)
b<-summary(Hmisc::contents(to_unlist$entities.mentions[[1]]))
b
b<-Hmisc::contents(to_unlist$entities.mentions[[1]])[2]
b<-tibble(nrow = Hmisc::contents(to_unlist$entities.mentions[[1]])[2][1],
ncol = Hmisc::contents(to_unlist$entities.mentions[[1]])[2][2])
View(b)
Hmisc::contents(to_unlist$entities.mentions[[1]])[2][1]
unlist(Hmisc::contents(to_unlist$entities.mentions[[1]])[2][1])
b<-unlist(Hmisc::contents(to_unlist$entities.mentions[[1]])[2][1])
b<-tibble(nrow = Hmisc::contents(to_unlist$entities.mentions[[1]])[2][1][1],
ncol = Hmisc::contents(to_unlist$entities.mentions[[1]])[2][1][2])
View(b)
Hmisc::contents(to_unlist$entities.mentions[[1]])[2][1][2]
Hmisc::contents(to_unlist$entities.mentions[[1]])[2][1][1]
Hmisc::contents(to_unlist$entities.mentions[[1]])[2][1]
Hmisc::contents(to_unlist$entities.mentions[[1]])[2]
Hmisc::contents(to_unlist$entities.mentions[[1]])[2][[1]]
Hmisc::contents(to_unlist$entities.mentions[[1]])[2][[1],1]
Hmisc::contents(to_unlist$entities.mentions[[1]])[2][[1]][1]
Hmisc::contents(to_unlist$entities.mentions[[1]])[2][[1]][2]
b<-tibble(nrow = Hmisc::contents(to_unlist$entities.mentions[[1]])[2][[1]][1],
ncol = Hmisc::contents(to_unlist$entities.mentions[[1]])[2][[1]][2])
View(b)
b<-tibble(twt_id = to_unlist$id[1],
nrow = Hmisc::contents(to_unlist$entities.mentions[[1]])[2][[1]][1],
ncol = Hmisc::contents(to_unlist$entities.mentions[[1]])[2][[1]][2])
View(b)
entities.mention.meta<-tibble()
for (i in 1:nrow(to_unlist)) {
b<-tibble(twt_id = to_unlist$id[1],
nrow = Hmisc::contents(to_unlist$entities.mentions[[1]])[2][[1]][1],
ncol = Hmisc::contents(to_unlist$entities.mentions[[1]])[2][[1]][2])
entities.mention.meta <- rbind(entities.mention.meta,b)
}
entities.mention.meta<-tibble()
for (i in 1:nrow(to_unlist)) {
b<-tibble(twt_id = to_unlist$id[i],
nrow = Hmisc::contents(to_unlist$entities.mentions[[i]])[2][[1]][1],
ncol = Hmisc::contents(to_unlist$entities.mentions[[i]])[2][[1]][2])
entities.mention.meta <- rbind(entities.mention.meta,b)
}
View(to_unlist)
class(to_unlist$entities.mentions[5])
class(to_unlist$entities.mentions[[5]])
entities.mention.meta<-tibble()
for (i in 1:nrow(to_unlist)) {
if(class(to_unlist$entities.mentions[[i]]) != "NULL"){
b<-tibble(twt_id = to_unlist$id[i],
nrow = Hmisc::contents(to_unlist$entities.mentions[[i]])[2][[1]][1],
ncol = Hmisc::contents(to_unlist$entities.mentions[[i]])[2][[1]][2])
entities.mention.meta <- rbind(entities.mention.meta,b)
}else{
b<- tibble(twt_id = to_unlist$id[i],
nrow = 0,
ncol = 0)
entities.mention.meta<- rbind(entities.mention.meta,b)
}
}
View(entities.mention.meta)
View(to_unlist)
c<-to_unlist %>% select(id,entities.mentions) %>% group_by(id) %>% unnest()
c<-to_unlist %>% select(id,entities.mentions) %>% group_by(id) %>% unnest(cols = c(entities.mentions))
View(c)
c<-test_flatt_rds1 %>% group_by(id) %>% unnest(cols = all_of(filter(test_flatt_rds1_meta, Storage == "list")),keep_empty = T, names_sep = "_")
c<-test_flatt_rds1 %>% group_by(id) %>% unnest(cols = all_of(test_flatt_rds1_meta$variable_names),keep_empty = T, names_sep = "_")
rlang::last_error()
rlang::last_trace()
c<-test_flatt_rds1 %>% group_by(id) %>% unnest(cols = entities.mentions,keep_empty = T, names_sep = "_")
View(c)
View(c[[15]][[13]])
c<-test_flatt_rds1 %>% group_by(id,entities.mentions) %>% unnest(cols = entities.mentions)
View(c)
c<-test_flatt_rds1 %>% group_by(id,entities.mentions) %>% unnest(cols = entities.mentions)
View(c)
c<- test_flatt_rds1 %>%select(id,entities.mentions) %>%  group_by(id) %>% unnest(cols = entities.mentions)
View(c)
c<- test_flatt_rds1 %>%select(id,entities.mentions) %>%  group_by(id) %>% unnest(cols = entities.mentions,sep = ".")
View(c)
c<- test_flatt_rds1 %>%select(id,entities.mentions) %>%  group_by(id) %>% unnest(cols = entities.mentions,names_sep = ".")
View(c)
c<- test_flatt_rds1 %>%select(id,entities.mentions) %>%  group_by(id) %>% unnest(cols = entities.mentions,names_sep = ".") %>% select(id,entities.mentions.usernames)
c<- test_flatt_rds1 %>%select(id,entities.mentions) %>%  group_by(id) %>% unnest(cols = entities.mentions,names_sep = ".") %>% select(id,entities.mentions.username)
View(c)
c<-to_unlist %>% group_by(id) %>% unnest(cols = all_of(colnames(to_unlist)),keep_empty = T, names_sep = "_")
#unnest test
#ok this unnests if I go one at a time.
to_unlist_names<-colnames(to_unlist)[-1]
#unnest test
#ok this unnests if I go one at a time.
to_unlist_names<-colnames(to_unlist)
#unnest test
#ok this unnests if I go one at a time.
to_unlist_names<-colnames(to_unlist)[-1]
for (i in 1:length(to_unlist_names)) {
c<- test_flatt_rds1 %>%
select(id,any_of(to_unlist_names[i])) %>%
group_by(id) %>%
unnest(cols = any_of(to_unlist_names[i]),names_sep = ".")
}
View(c)
for (i in 1:length(to_unlist_names)) {
c[i]<- test_flatt_rds1 %>%
select(id,any_of(to_unlist_names[i])) %>%
group_by(id) %>%
unnest(cols = any_of(to_unlist_names[i]),names_sep = ".")
}
c<-list()
for (i in 1:length(to_unlist_names)) {
c[i]<- test_flatt_rds1 %>%
select(id,any_of(to_unlist_names[i])) %>%
group_by(id) %>%
unnest(cols = any_of(to_unlist_names[i]),names_sep = ".")
}
View(c)
for (i in 1:length(to_unlist_names)) {
c[i]<- test_flatt_rds1 %>%
select(id,to_unlist_names[i]) %>%
group_by(id) %>%
unnest(cols = to_unlist_names[i],names_sep = ".")
}
View(to_unlist)
View(to_unlist[[2]][[1]])
View(to_unlist)
c<- to_unlist %>%
unnest(cols = all_of(to_unlist_names),names_sep = ".")
c<- to_unlist %>%  unnest(cols = all_of(to_unlist_names[1]),names_sep = ".")
c<- to_unlist %>%  unnest(cols = all_of(to_unlist_names[2]),names_sep = ".")
c<- to_unlist %>%  unnest(cols = all_of(to_unlist_names[3]),names_sep = ".")
c<- to_unlist %>%  unnest(cols = all_of(to_unlist_names[4]),names_sep = ".")
View(c)
View(c)
c<- to_unlist %>%  unnest(cols = all_of(to_unlist_names[5]),names_sep = ".")
View(c)
c<- to_unlist %>%  unnest(cols = all_of(to_unlist_names[6]),names_sep = ".")
c<- to_unlist %>%  unnest(cols = all_of(to_unlist_names[7]),names_sep = ".")
c<- to_unlist %>%  unnest(cols = all_of(to_unlist_names[8]),names_sep = ".")
View(c)
to_unlist_names
View(to_unlist)
c<- to_unlist %>%  unnest(cols = all_of(to_unlist_names[1:7]),names_sep = ".")
c<- to_unlist %>%  unnest(cols = all_of(to_unlist_names[1:6]),names_sep = ".")
c<- to_unlist %>%  unnest(cols = all_of(to_unlist_names[1:2]),names_sep = ".")
View(test_flatt_rds1)
View(test_rds1)
